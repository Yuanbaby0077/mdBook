虚拟DOM：
  虚拟DOM是用来描述真是DOM的JavaScript对象，虚拟DOM算法操作真实DOM，性能高于直接操作真实DOM。虚拟DOM算法=虚拟DOM+diff算法。

Diff算法：Diff算法只会比较同层级的对象，不会越级比较。因此是深度优先算法。

通过patch方法

patch(oldVnode, newVnode) {
  // 如果是相同的节点，patchNode
  if (sameVnode(oldVnode, newVnode)) {
    patchVnode(oldVnode, newVnode)
  } else { // 不是相同节点，直接替换
    const oldEl = oldVnode.el // 获取旧虚拟DOM的el对象
    const parent = parentNode(oldEl) // 获取old el对象的父节点
    createEl(newVnode) // 创建新的虚拟dom的真实节点
    if (parent) {
      // 插入到旧节点的下一个兄弟节点之前
      parent.insertBefore(newVnode.el, nextSibling(oldEl))
      // 移除旧节点
      removeChild(oldEl)
      oldVnode = null // 释放内存
    }
  }
}

patchVnode(oldVnode, newVnode) {
  const el = oldVnode.el = newVnode
  // 如果节点完全相等
  if (oldVnode === newVnode) return
  // 子节点
  oChildren = oldVnode.children
  nChildren = newVnode.children
  // 文本节点
  if (oChildren && nCHildren) { // 新旧都有子节点
    updateChildren(el, oChildren, nChildren) // 新旧虚拟DOM对比子节点，并更新
  } else if(ochildren) { 
    // 旧的DOM有子节点，新的没有，删除el中对应的子节点
  } else if(nChildren) { 
    // 新的DOM有子节点，旧的没有，el中添加新DOM中的子节点
  } else if (newVnode.text && oldVnode.text !== newVnode.text) { // 文本节点
    // el的文本更新为newVnode.text
  }
}

// 重头戏 updateChildren 新旧虚拟DOM的子节点对比，使用头尾指针的方式
// 旧头指针oldS 旧尾指针oldE 新头指针newS 新尾指针newE
// 1、oldS和newS，sameVnode(oldS, newS)
// 2、oldS 和 newE，sameVnode(oldS, newE)
// 3、oldE和newS，sameVnode(oldE, newS)
// 4、oldE 和 newE，sameVnode(oldE, newE)
// 5、如果以上匹配失败，则
updateChildren(el, newCh, oldCh) {

}

v-for循环渲染的时候，为什么不建议使用index作为key值

性能消耗
使用 index 做 key，破坏顺序操作的时候， 因为每一个节点都找不到对应的 key，导致部分节点不能复用,所有的新 vnode 都需要重新创建。

数据错位：
从上面比对可以看出来这时因为采用 index 作为 key 时，当在比较时，发现虽然文本值变了，但是当继续向下比较时发现  DOM 节点还是和原来一摸一样，就复用了，但是没想到 input 输入框残留输入的值，这时候就会出现输入的值出现错位的情况


var a = [1,2,3]

a.unshift(4)
 a = [4, 1,2,3]

 此时 完全相同的节点无法复用，index=0时，旧节点头指针oldS 值:1 index:0 和 新节点头指针oldS 值:4 index:0是相同节点，需要执行patchNode逻辑，同理2，3和1，2也是，而新节点中3变成了新增的节点。造成节点全部更新。

 如果使用独一无二的例如id作为key值，那么新旧节点1、2、3就视为相同的节点，直接复用。只会新增4这个节点。


[diff算法详解](https://blog.csdn.net/zl_Alien/article/details/106595459)
[Vue 3 Virtual Dom Diff源码阅读](https://segmentfault.com/a/1190000038654183)


